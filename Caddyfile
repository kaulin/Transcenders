(logging) {
	log {
		output file /var/log/caddy.log
		format json
	}
}

# serve on app.transcenders.online domain
app.transcenders.online {
	import logging
	@skip path_regexp \.(js|css|png|jpe?g|gif|ico|woff|otf|ttf|eot|svg|txt|pdf|docx?|xlsx?)$
	log_skip @skip

	tls prod@transcenders.online {
		ca https://acme.zerossl.com/v2/DV90
	}

	encode gzip zstd

	handle_path /api/* {
		@auth path /auth*
		@users path /users* /friendships* /avatars* /admin* /media*
		@score path /score*
		reverse_proxy @users user-service:3000
		reverse_proxy @auth auth-service:3000
		reverse_proxy @score score-service:3000
	}

	handle {
		root * /usr/share/caddy
		try_files {path} /index.html
		file_server
	}
}
